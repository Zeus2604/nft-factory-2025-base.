<!DOCTYPE html>
<html>
<head>
  <title>NFT Factory by Almar55</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Generate up to 500 NFTs for free</h1>
  <p>This site is for owners of the NFT Halloween_Almar_PFP</p>
  <button onclick="generate()">Generate NFTs</button>
</body>

<script>
async function generate() {
    const count = Math.min(500, 20); // Limita a 500, usa 20 para pruebas
    const response = await fetch('./config.json');
    const config = await response.json();

    async function create() {
        for (let i = 0; i < count; i++) {
            // Generar rutas para cada capa
            const layers = config.layersOrder.map(layer => {
                const imgNumber = Math.floor(Math.random() * config.imagesPerLayer) + 1;
                // Ruta exacta: e.g., BACKGROUNDS/1BACKGROUND.png
                return `${layer.folder}/${imgNumber}${layer.fileSuffix}.png`;
            });

            const canvas = document.createElement('canvas');
            canvas.width = config.format.width;
            canvas.height = config.format.height;
            const ctx = canvas.getContext('2d');

            // Fondo negro
            ctx.fillStyle = config.background.color;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Dibujar capas en orden
            for (let l of layers) {
                console.log(`Intentando cargar: ${l}`); // Depurar rutas
                const img = new Image();
                img.src = l;

                // Esperar carga de imagen
                try {
                    await new Promise((resolve, reject) => {
                        img.onload = () => {
                            console.log(`Cargada: ${l}`);
                            resolve();
                        };
                        img.onerror = () => {
                            console.error(`Error al cargar: ${l}`);
                            resolve(); // Contin√∫a aunque falle
                        };
                    });
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                } catch (e) {
                    console.error(`Error al dibujar: ${l}`, e);
                }
            }

            // Descargar NFT
            const link = document.createElement('a');
            link.href = canvas.toDataURL('image/png');
            link.download = `nft-${i+1}.png`;
            link.click();
        }
    }

    await create();
}
</script>
</html>
